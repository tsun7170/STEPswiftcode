--- ap242ed2_mim_lf_v1.101.exp	2021-11-15 05:18:05.000000000 +0900
+++ ap242ed2_mim_lf_v1.101.TY.exp	2021-11-16 05:45:32.000000000 +0900
@@ -4,6 +4,28 @@
    Supersedes ISO TC184/SC4/WG3 N10384
 *)
 
+(*
+ 	original schema file ap242ed2_mim_lf_v1.101.exp (AP242 2nd Edition - 2019) 
+ 			from 	https://www.cax-if.org/cax/cax_express.php
+ 			or 		https://www.iso.org/standard/66654.html
+ 
+ 	patch file was generated by the terminal command:
+ 			diff -u ap242ed2_mim_lf_v1.101.exp ap242ed2_mim_lf_v1.101.TY.exp > ap242ed2_mim_lf_v1.101.TY.exp.patch
+ 
+ 	patched schema file can be regenerated by the terminal command:
+ 			patch -u  --input=ap242ed2_mim_lf_v1.101.TY.exp.patch --output=ap242ed2_mim_lf_v1.101.TY.exp
+*)
+ 
+(*
+ 	patched schema file: ap242ed2_mim_lf_v1.101.TY.exp
+ 
+  2021/08/12: fixed logic error in surface_style_rendering_with_properties.WR1
+  2021/06/10: modified FUNCTION using_items() to prevent duplicated search.
+  2021/02/28: slightly modified for exp2swift translation, plus some bug fixes on original schema definition.
+ 
+ 	by Tsutomu Yoshida, Minokamo, Japan.
+*)
+ 
 -- -*- Mode: Express -*-
 
 (* ===================================================================================== *)
@@ -6025,22 +6047,24 @@
   measured_data_type        : a3m_measured_data_type_name;
   detected_difference_types : LIST [0 : ?] OF a3m_detected_difference_type_name;
   accuracy_types            : LIST [0 : ?] OF a3m_accuracy_type_name;
+ (**TY2021/02/28 bug fix:
 WHERE
   WR1: SIZEOF(USEDIN(SELF,
                      'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DATA_EQUIVALENCE_CRITERION_ASSESSMENT_ASSOCIATION.CRITERION')) =
-       0;
+       0;	--TY2020/12/12 NEED TO CHECK 'DATA_EQUIVALENCE_CRITERION_ASSESSMENT_ASSOCIATION'
   WR2: SIZEOF(QUERY(i1
                     <* bag_to_set(USEDIN(SELF,
                                          'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.REPRESENTATION_ITEM_RELATIONSHIP.RELATED_REPRESENTATION_ITEM'))
                     | 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DATA_EQUIVALENCE_CRITERION_INSPECTION_ASSOCIATION' IN
                       TYPEOF(i1))) =
-       0;
+       0; --TY2021/02/28 NEED TO CHECK 'DATA_EQUIVALENCE_CRITERION_INSPECTION_ASSOCIATION'
   WR3: SIZEOF(QUERY(i1
                     <* bag_to_set(USEDIN(SELF,
                                          'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.REPRESENTATION_ITEM_RELATIONSHIP.RELATING_REPRESENTATION_ITEM'))
                     | 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DATA_EQUIVALENCE_CRITERION_INSPECTION_ASSOCIATION' IN
                       TYPEOF(i1))) =
-       0;
+       0; --TY2021/02/28 NEED TO CHECK 'DATA_EQUIVALENCE_CRITERION_INSPECTION_ASSOCIATION'
+ *)
 END_ENTITY;
 
 ENTITY a3m_equivalence_criterion_for_assembly
@@ -7396,7 +7420,7 @@
   SUBTYPE OF (half_space_2d);
   SELF\half_space_2d.base_curve : composite_curve;
 WHERE
-  WR1: base_curve\composite_curve.closed_curve = true;
+  WR1: base_curve\composite_curve.closed_curve = true;	-- //*TY2020/11/10 need to review \composite_curve.
 END_ENTITY;
 
 ENTITY array_placement_group
@@ -14501,7 +14525,7 @@
                                                     | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS') IN
                                                        TYPEOF(pdr.used_representation)))
                                            | (NOT (SIZEOF(QUERY(it
-                                                                <* impl_rep.used_representation.items
+                                                                <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                 | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                     TYPEOF(it)) AND
                                                                    (it.name = 'removal direction') AND
@@ -14820,7 +14844,7 @@
                                                      | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS') IN
                                                         TYPEOF(pdr.used_representation)))
                                             | (NOT (SIZEOF(QUERY(it
-                                                                 <* impl_rep.used_representation.items
+                                                                 <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                  | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                      TYPEOF(it)) AND
                                                                     (it.name = 'module or diametral pitch') AND
@@ -14860,7 +14884,7 @@
                                                      | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS') IN
                                                         TYPEOF(pdr.used_representation)))
                                             | (NOT (SIZEOF(QUERY(it
-                                                                 <* impl_rep.used_representation.items
+                                                                 <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                  | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                      TYPEOF(it)) AND
                                                                     (it.name = 'internal or external gear') AND
@@ -16382,7 +16406,7 @@
                                                       | 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS' IN
                                                         TYPEOF(pdr.used_representation))
                                              | NOT (SIZEOF(QUERY(it
-                                                                 <* impl_rep.used_representation.items
+                                                                 <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                  | (SIZEOF(['AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.MEASURE_REPRESENTATION_ITEM',
                                                                             'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.LENGTH_MEASURE_WITH_UNIT'] *
                                                                            TYPEOF(it)) =
@@ -16403,7 +16427,7 @@
                                                       | 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS' IN
                                                         TYPEOF(pdr.used_representation))
                                              | NOT (SIZEOF(QUERY(it
-                                                                 <* impl_rep.used_representation.items
+                                                                 <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                  | ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                     TYPEOF(it)) AND
                                                                    (it.name = 'module or diametral pitch') AND
@@ -16424,7 +16448,7 @@
                                                       | 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS' IN
                                                         TYPEOF(pdr.used_representation))
                                              | NOT (SIZEOF(QUERY(it
-                                                                 <* impl_rep.used_representation.items
+                                                                 <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                  | ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                     TYPEOF(it)) AND
                                                                    (it.name = 'internal or external gear') AND
@@ -16506,7 +16530,7 @@
                                                        | 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS' IN
                                                          TYPEOF(pdr.used_representation))
                                               | NOT (SIZEOF(QUERY(it
-                                                                  <* impl_rep.used_representation.items
+                                                                  <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                   | ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                      TYPEOF(it)) AND
                                                                     (it.name = 'gear tooth') AND
@@ -16615,6 +16639,8 @@
   SUBTYPE OF (shape_aspect);
   base      : datum_or_common_datum;
   modifiers : OPTIONAL SET [1 : ?] OF datum_reference_modifier;
+ DERIVE	--*TY2021/02/22
+ 	base_common_datum_list :common_datum_list := base; --*TY2021/02/22
 WHERE
   WR1: SELF\shape_aspect.name = '';
   WR2: NOT EXISTS(SELF\shape_aspect.description);
@@ -16623,7 +16649,7 @@
   WR5: NOT ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DATUM' IN TYPEOF(base)) OR
            (SELF\shape_aspect.of_shape = base\shape_aspect.of_shape);
   WR6: NOT ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.COMMON_DATUM_LIST' IN TYPEOF(base)) OR
-           (SELF\shape_aspect.of_shape = base[1]\shape_aspect.of_shape);
+           (SELF\shape_aspect.of_shape = base_common_datum_list[1]\shape_aspect.of_shape); --*TY2021/02/22: (SELF\shape_aspect.of_shape = base[1]\shape_aspect.of_shape);
 END_ENTITY;
 
 ENTITY general_feature
@@ -26504,7 +26530,7 @@
                                                     | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS') IN
                                                        TYPEOF(pdr.used_representation)))
                                            | (NOT (SIZEOF(QUERY(it
-                                                                <* impl_rep.used_representation.items
+                                                                <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                 | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                     TYPEOF(it)) AND
                                                                    (it.name = 'shape profile floor orientation') AND
@@ -31290,7 +31316,11 @@
   SUBTYPE OF (surface_style_rendering);
   properties : SET [1 : 2] OF rendering_properties_select;
 WHERE
-  WR1: (HIINDEX(properties) = 1) XOR (TYPEOF(properties[1]) <> TYPEOF(properties[2]));
+--*TY2021/08/12  WR1: (HIINDEX(properties) = 1) XOR (TYPEOF(properties[1]) <> TYPEOF(properties[2]));
+ WR1: (HIINDEX(properties) = 1) OR (TYPEOF(properties[1]) <> TYPEOF(properties[2])); (*TY2021/08/12
+ since (ref. ISO 10303-46 (6.4.62))
+ 	WR1: All of the properties shall be of different types.
+ *)
 END_ENTITY;
 
 ENTITY surface_style_segmentation_curve
@@ -32411,7 +32441,7 @@
                                                    | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS') IN
                                                       TYPEOF(pdr.used_representation)))
                                           | (NOT (SIZEOF(QUERY(it
-                                                               <* impl_rep.used_representation.items
+                                                               <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                    TYPEOF(it)) AND
                                                                   (it.name = 'hand') AND
@@ -32444,7 +32474,7 @@
                                                     | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS') IN
                                                        TYPEOF(pdr.used_representation)))
                                            | (NOT (SIZEOF(QUERY(it
-                                                                <* impl_rep.used_representation.items
+                                                                <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                 | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                     TYPEOF(it)) AND
                                                                    (it.name = 'thread side') AND
@@ -32639,7 +32669,7 @@
                                                    | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS') IN
                                                       TYPEOF(pdr.used_representation)))
                                           | (NOT (SIZEOF(QUERY(it
-                                                               <* impl_rep.used_representation.items
+                                                               <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                    TYPEOF(it)) AND
                                                                   (it.name = 'pitch or dimension') AND
@@ -32657,7 +32687,7 @@
                                                    | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_REPRESENTATION_WITH_PARAMETERS') IN
                                                       TYPEOF(pdr.used_representation)))
                                           | (NOT (SIZEOF(QUERY(it
-                                                               <* impl_rep.used_representation.items
+                                                               <* impl_rep.used_representation\SHAPE_REPRESENTATION_WITH_PARAMETERS(*TY2021/01/24*).items
                                                                | (('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.DESCRIPTIVE_REPRESENTATION_ITEM' IN
                                                                    TYPEOF(it)) AND
                                                                   (it.name = 'included or extra') AND
@@ -33923,7 +33953,7 @@
   retval   : SET OF a3ma_accuracy_type_name := [];
 END_LOCAL;
   REPEAT i := 1 TO SIZEOF(ei);
-    type_out := a3ma_get_value_limit_type(ei[i].specific_accuracy.range);
+    type_out := a3ma_get_value_limit_type(ei[i].specific_accuracy.range); --*TY2021/02/28 NEED TO REVIEW; questionable func call; result not used
     retval := retval + [atna_others];
   END_REPEAT;
   RETURN(retval);
@@ -34866,10 +34896,11 @@
 FUNCTION acyclic_composite_text(start_composite : composite_text;
                                 child_text : SET [1 : ?] OF text_or_character) : LOGICAL;
 LOCAL
-  i                     : INTEGER;
+  -- i                     : INTEGER; *TY2021/02/28 eliminated unused var
   local_composite_text  : SET [0 : ?] OF composite_text;
   local_annotation_text : SET [0 : ?] OF annotation_text;
   local_children        : SET [0 : ?] OF text_or_character;
+  set__text_or_character : SET [0 : ?] OF text_or_character; --*TY2021/02/25
 END_LOCAL;
   local_composite_text := QUERY(child
                                 <* child_text
@@ -34897,13 +34928,19 @@
   IF (SIZEOF(local_annotation_text) > 0)
   THEN
     REPEAT i := 1 TO HIINDEX(local_annotation_text);
-      local_children := local_children +
+ 			set__text_or_character := QUERY(item
+															 <* local_annotation_text[i]\mapped_item.mapping_source.mapped_representation.items
+															 | SIZEOF(['AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.ANNOTATION_TEXT',
+																				 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.COMPOSITE_TEXT'] *
+																				TYPEOF(item)) >
+																 0); --*TY2021/02/25
+      local_children := local_children + set__text_or_character; (**TY2021/02/25
                         QUERY(item
                               <* local_annotation_text[i]\mapped_item.mapping_source.mapped_representation.items
                               | SIZEOF(['AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.ANNOTATION_TEXT',
                                         'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.COMPOSITE_TEXT'] *
                                        TYPEOF(item)) >
-                                0);
+                                0); *)
     END_REPEAT;
   END_IF;
   IF (local_children :<>: child_text)
@@ -35039,16 +35076,16 @@
       IF SIZEOF(rms) > 0
       THEN
         REPEAT j := 1 TO HIINDEX(rms);
-          mis := bag_to_set(USEDIN(rms[i],
+          mis := bag_to_set(USEDIN(rms[j(**TY2021/02/28 bug fix: i *)],
                                    'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.MAPPED_ITEM.MAPPING_SOURCE'));
           IF SIZEOF(mis) > 0
           THEN
-            REPEAT j := 1 TO HIINDEX(mis);
-              IF mis[i] :=: mi
+            REPEAT k(**TY2021/02/28 bug fix: j *) := 1 TO HIINDEX(mis);
+              IF mis[k(**TY2021/02/28 bug fix: i *)] :=: mi
               THEN
                 RETURN(false);
               END_IF;
-              rs2 := rs2 + using_representations(mis[i]);
+              rs2 := rs2 + using_representations(mis[k(**TY2021/02/28 bug fix: i*)]);
             END_REPEAT;
           END_IF;
         END_REPEAT;
@@ -35146,6 +35183,7 @@
                                              specific_relation : STRING) : BOOLEAN;
 LOCAL
   x : SET OF representation_relationship;
+  set__representation : SET OF representation; --*TY2021/02/25
 END_LOCAL;
   IF relation.rep_1 IN relatives
   THEN
@@ -35156,7 +35194,8 @@
                                   'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.REPRESENTATION_RELATIONSHIP.REP_2'))
              | specific_relation IN TYPEOF(r));
   REPEAT i := 1 TO HIINDEX(x);
-    IF NOT acyclic_representation_relationship(x[i], relatives + relation.rep_1, specific_relation)
+ 		set__representation := relation.rep_1; --*TY2021/02/25
+    IF NOT acyclic_representation_relationship(x[i], relatives + set__representation(**TY2021/02/25: relation.rep_1 *), specific_relation)
     THEN
       RETURN(false);
     END_IF;
@@ -35803,7 +35842,7 @@
 
 FUNCTION check_continuous_edges(edges : LIST OF UNIQUE edge_curve) : BOOLEAN;
 LOCAL
-  i           : INTEGER;
+  -- i           : INTEGER; **TY2021/02/28 eliminated unused var
   next_vertex : vertex;
 END_LOCAL;
   IF (SIZEOF(edges) = 1)
@@ -35844,8 +35883,8 @@
 FUNCTION check_curve_planarity(checked_curve : curve) : BOOLEAN;
 LOCAL
   crv    : curve   := checked_curve;
-  i      : INTEGER;
-  j      : INTEGER;
+  -- i      : INTEGER;	**TY2021/02/28 eliminated unused var
+  -- j      : INTEGER;	**TY2021/02/28 eliminated unused var
   result : BOOLEAN := false;
 END_LOCAL;
   IF (SIZEOF(['AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.CONIC',
@@ -36664,7 +36703,7 @@
 
 FUNCTION compute_total_depth(swsrh : solid_with_stepped_round_hole) : positive_length_measure;
 LOCAL
-  i  : positive_integer;
+  -- i  : positive_integer; **TY2021/02/28 eliminated unused var
   n  : positive_integer        := swsrh.segments;
   td : positive_length_measure := swsrh.segment_depths[1];
 END_LOCAL;
@@ -37149,6 +37188,7 @@
   bval  : maths_binary;
   tval  : maths_tuple   := the_empty_maths_tuple;
   mval  : maths_value;
+  val_list : LIST OF GENERIC; --*TY2021/02/20
 END_LOCAL;
   IF (schema_prefix + 'MATHS_VALUE') IN types
   THEN
@@ -37191,8 +37231,9 @@
   END_IF;
   IF 'LIST' IN types
   THEN
-    REPEAT i := 1 TO SIZEOF(val);
-      mval := convert_to_maths_value(val[i]);
+ 		val_list := val; --*TY2021/02/20
+    REPEAT i := 1 TO SIZEOF(val_list); --*TY2021/02/20: REPEAT i := 1 TO SIZEOF(val);
+      mval := convert_to_maths_value(val_list[i]); --*TY2021/02/20: mval := convert_to_maths_value(val[i]);
       IF NOT EXISTS(mval)
       THEN
         RETURN(?);
@@ -37439,7 +37480,7 @@
 LOCAL
   nops : INTEGER             := 2;
   vspc : maths_space;
-  dim  : nonnegative_integer;
+  -- dim  : nonnegative_integer;	**TY2021/02/28 eliminated unused var
   k    : positive_integer;
   bspc : maths_space;
 END_LOCAL;
@@ -37518,6 +37559,78 @@
    references during recursive calls to this function. The parameter
    lists already tested instances in a chain of references.
     *)
+ 
+ --*TY2021/06/23: proposed implementation
+ 
+ (*NESTED*) FUNCTION is_referenced_by_outer_world(subject  : GENERIC : CGEN;
+ 																								 in_chain : LIST OF GENERIC : CGEN) : BOOLEAN;
+   	LOCAL
+ 			set_of_referring_instances    : SET OF GENERIC : CGEN;
+ 			number_of_referring_instances : INTEGER;
+ 			child                         : GENERIC : CGEN;
+			set_of_types                  : SET OF STRING;
+ 		END_LOCAL;
+ 
+ 		IF subject IN succeededs THEN
+ 			RETURN(true);
+ 		END_IF;
+ 
+ 		IF subject IN dead_ends THEN
+ 			RETURN(false);
+ 		END_IF;
+ 
+		set_of_referring_instances := bag_to_set(USEDIN(subject, ''));
+ 		IF NOT EXISTS(set_of_referring_instances) THEN
+ 			dead_ends := dead_ends + subject;
+ 			RETURN(false);	-- origin of dead_end(1)
+ 		END_IF;
+ 
+ 		set_of_referring_instances := set_of_referring_instances - (dead_ends + in_chain);
+
+ 		number_of_referring_instances := SIZEOF(set_of_referring_instances);
+ 		REPEAT j := 1 TO number_of_referring_instances;
+ 			child := set_of_referring_instances[j];
+ 			set_of_types := TYPEOF(child);
+ 
+ 			IF NOT (set_of_types <= set_of_input_types) THEN
+ 				succeededs := succeededs + in_chain + subject + child;
+ 				RETURN(true);	-- origin of succeeded(1)
+			END_IF;
+ 
+ 			IF is_referenced_by_outer_world(child, in_chain + subject) THEN
+ 				RETURN(true);
+ 			END_IF;
+ 		END_REPEAT;
+ 
+ 		dead_ends := dead_ends + subject;
+ 		RETURN(false);	-- origin of dead_end(2)
+ END_FUNCTION (*NESTED*);
+ 
+ LOCAL
+ 	 succeededs : SET OF GENERIC : CGEN := [];
+   dead_ends : SET OF GENERIC: CGEN := [];
+   number_of_input_instances     : INTEGER;
+   input_instance_CGEN: GENERIC:CGEN;
+ END_LOCAL;
+ 
+ IF NOT EXISTS(set_of_input_instances) THEN
+ 	 RETURN(false);
+ END_IF;
+ 
+ number_of_input_instances := SIZEOF(set_of_input_instances);
+ set_of_input_types := set_of_input_types + 'GENERIC';
+ 
+ REPEAT i := 1 TO number_of_input_instances;
+  input_instance_CGEN := set_of_input_instances[i];
+  IF NOT is_referenced_by_outer_world(input_instance_CGEN, previous_in_chain) THEN
+ 		RETURN(false);
+  END_IF;
+ END_REPEAT;
+ 
+ RETURN(true);
+ 
+ 
+ (* --*TY2021/06/23: original implementation
 LOCAL
   number_of_input_instances     : INTEGER;
   number_of_referring_instances : INTEGER;
@@ -37526,6 +37639,7 @@
   previous_in_chain_plus        : LIST OF GENERIC : CGEN := [];
   result                        : BOOLEAN                := true;
   set_of_types                  : SET OF STRING          := [];
+ 	input_instance_CGEN: GENERIC:CGEN; --*TY2021/02/20
 END_LOCAL;
   IF EXISTS(set_of_input_instances)
   THEN
@@ -37543,7 +37657,8 @@
           THEN
             IF NOT (bag_of_referring_instances[j] IN previous_in_chain)
             THEN
-              previous_in_chain_plus := previous_in_chain + set_of_input_instances[i];
+ 							input_instance_CGEN := set_of_input_instances[i]; --*TY2021/02/20
+              previous_in_chain_plus := previous_in_chain + input_instance_CGEN; --*TY2021/02/20: previous_in_chain_plus := previous_in_chain + set_of_input_instances[i];
               IF dependently_instantiated([bag_of_referring_instances[j]], set_of_input_types, previous_in_chain_plus)
               THEN
                 dependently_instantiated_flag := true;
@@ -37569,8 +37684,10 @@
     RETURN(false);
   END_IF;
   RETURN(true);
+ --*TY2021/06/23: end of original implementation *)
 END_FUNCTION;
 
+ 
 FUNCTION derive_angle(placement_1 : axis2_placement_3d;
                       placement_2 : axis2_placement_3d) : plane_angle_measure;
 LOCAL
@@ -40088,7 +40205,7 @@
   factors2  : LIST OF maths_space;
   fs1       : function_space;
   fs2       : function_space;
-  cum2      : LOGICAL;
+  -- cum2      : LOGICAL; **TY2021/02/28 eliminated unused var
 END_LOCAL;
   IF spc1 = spc2
   THEN
@@ -40657,6 +40774,7 @@
   root            : SET OF product_definition;
   i               : INTEGER                         := 0;
   j               : INTEGER                         := 0;
+  pd : product_definition; --*TY2021/02/25 
 END_LOCAL;
   IF ((SIZEOF(constituent) = 1) AND assembly_root(constituent[1]))
   THEN
@@ -40688,7 +40806,8 @@
           REPEAT j := 1 TO HIINDEX(constituent);
             IF (local_relation[i].relating_product_definition <> constituent[j])
             THEN
-              local_parent := local_parent + local_relation[i].relating_product_definition;
+ 							pd := local_relation[i].relating_product_definition; --*TY2021/02/25
+              local_parent := local_parent + pd; --*TY2021/02/25: local_relation[i].relating_product_definition;
             END_IF;
           END_REPEAT;
         END_REPEAT;
@@ -40757,7 +40876,7 @@
   local_s_d_r  : SET OF shape_definition_representation := [];
   local_s_d_r2 : BAG OF shape_definition_representation := [];
   local_s_r    : SET OF shape_representation            := [];
-  i            : INTEGER;
+  -- i            : INTEGER; **TY2021/02/28 eliminated unused var
 END_LOCAL;
   local_p_d_s2 := local_p_d_s2 +
                   QUERY(pd
@@ -40790,7 +40909,7 @@
   local_s_d_r  : SET OF shape_definition_representation := [];
   local_s_d_r2 : BAG OF shape_definition_representation := [];
   local_s_r    : SET OF shape_representation            := [];
-  i            : INTEGER;
+  -- i            : INTEGER; **TY2021/02/28 eliminated unused var
 END_LOCAL;
   local_p_d := bag_to_set(USEDIN(item,
                                  'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.PROPERTY_DEFINITION.DEFINITION'));
@@ -41336,7 +41455,7 @@
   adrs_raw      : SET OF applied_document_reference   := bag_to_set(USEDIN(pdc,
                                                                            'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.APPLIED_DOCUMENT_REFERENCE.ITEMS'));
   adrs_filtered : SET OF applied_document_reference   := [];
-  ras           : SET OF role_association;
+  -- ras           : SET OF role_association; **TY2021/02/28 eliminated unused var
   dpas          : SET OF document_product_association;
 END_LOCAL;
   REPEAT i := 1 TO HIINDEX(adrs_raw);
@@ -41525,6 +41644,7 @@
                             END_IF;
     END;
   END_CASE;
+ RETURN(?); --*TY2021/02/18 bug fix
 END_FUNCTION;
 
 FUNCTION get_descendant_occurrences(input : product_definition_occurrence) : SET [0 : ?] OF product_definition_specified_occurrence;
@@ -41973,7 +42093,7 @@
   reps : SET [1 : ?] OF representation                  := using_representations(item);
   svri : SET [1 : ?] OF variational_representation_item;
   iar  : instance_attribute_reference;
-  i    : INTEGER;
+  -- i    : INTEGER; **TY2021/02/28 eliminated unused var
   n    : INTEGER                                        := HIINDEX(reps);
 END_LOCAL;
   IF ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.BOUND_VARIATIONAL_PARAMETER' IN TYPEOF(item))
@@ -42322,10 +42442,12 @@
 FUNCTION list_of_topology_reversed(a_list : list_of_reversible_topology_item) : list_of_reversible_topology_item;
 LOCAL
   the_reverse : list_of_reversible_topology_item;
+  aggr_or_elem : GENERIC; --*TY2021/02/25
 END_LOCAL;
   the_reverse := [];
   REPEAT i := 1 TO SIZEOF(a_list);
-    the_reverse := topology_reversed(a_list[i]) + the_reverse;
+ 		aggr_or_elem := topology_reversed(a_list[i]); --*TY2021/02/25
+    the_reverse := aggr_or_elem (**TY2021/02/25: topology_reversed(a_list[i]) *) + the_reverse;
   END_REPEAT;
   RETURN(the_reverse);
 END_FUNCTION;
@@ -42537,7 +42659,7 @@
                           delta : maths_number;
                           incs : positive_integer) : SET [2 : ?] OF maths_number;
 LOCAL
-  i           : INTEGER;
+  -- i           : INTEGER; **TY2021/02/28 eliminated unused var
   numeric_set : SET [2 : ?] OF maths_number := [start,(start + delta)];
 END_LOCAL;
   IF incs > 1
@@ -42797,6 +42919,7 @@
     END_IF;
     OTHERWISE: RETURN(false);
   END_CASE;
+  RETURN(false); --*TY2021/02/28 bug fix
 END_FUNCTION;
 
 FUNCTION md_valid_content_in_geometric_set_for_placeholder(input : geometric_set) : BOOLEAN;
@@ -42806,8 +42929,28 @@
   texts      : BAG OF annotation_text := [];
   placements : BAG OF placement       := [];
   points     : BAG OF point           := [];
-END_LOCAL;
-  REPEAT i := LOINDEX(input\geometric_set.elements) TO HIINDEX(input\geometric_set.elements);
+  p_bx : planar_box; --*TY2021/02/26
+  a_tx : annotation_text; --*TY2021/02/26
+  pl : placement; --*TY2021/02/26
+  pt : point; --*TY2021/02/26
+END_LOCAL;
+  REPEAT i := LOINDEX(input\geometric_set.elements) TO HIINDEX(input\geometric_set.elements); 
+ 
+    IF ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.POINT' IN TYPEOF(input\geometric_set.elements[i])) 
+    THEN
+      IF NOT (SIZEOF(['AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.CARTESIAN_POINT',
+								 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.POINT_ON_CURVE',
+								 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.POINT_ON_SURFACE'] *
+								TYPEOF(input\geometric_set.elements[i])) =
+				 1)
+      THEN
+	      pass := false;
+      ELSE
+   			pt := input\geometric_set.elements[i]; --*TY2021/02/26
+	      points := points + pt; --*TY2021/02/26: input\geometric_set.elements[i];
+      END_IF;
+    END_IF;
+(**TY2021/02/26 bug fix
     IF ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.POINT' IN TYPEOF(input\geometric_set.elements[i])) AND
        NOT (SIZEOF(['AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.CARTESIAN_POINT',
                     'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.POINT_ON_CURVE',
@@ -42819,17 +42962,21 @@
     ELSE
       points := points + input\geometric_set.elements[i];
     END_IF;
+ *)
     IF 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.PLANAR_BOX' IN TYPEOF(input\geometric_set.elements[i])
     THEN
-      boxes := boxes + input\geometric_set.elements[i];
+      p_bx := input\geometric_set.elements[i]; --*TY2021/02/26
+      boxes := boxes + p_bx; --*TY2021/02/26: input\geometric_set.elements[i];
     END_IF;
     IF 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.ANNOTATION_TEXT' IN TYPEOF(input\geometric_set.elements[i])
     THEN
-      texts := texts + input\geometric_set.elements[i];
+ 			a_tx := input\geometric_set.elements[i]; --*TY2021/02/26
+      texts := texts + a_tx; --*TY2021/02/26: input\geometric_set.elements[i];
     END_IF;
     IF 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.PLACEMENT' IN TYPEOF(input\geometric_set.elements[i])
     THEN
-      placements := placements + input\geometric_set.elements[i];
+			pl := input\geometric_set.elements[i]; --*TY2021/02/26
+      placements := placements + pl; --*TY2021/02/26: input\geometric_set.elements[i];
     END_IF;
   END_REPEAT;
   IF SIZEOF(boxes) > 1
@@ -42866,12 +43013,13 @@
   tmp_int   : INTEGER;
   tmp_real  : REAL;
   tmp_cmplx : complex_number_literal;
-  lgcl      : LOGICAL;
-  cum       : LOGICAL;
+  -- lgcl      : LOGICAL; **TY2021/02/28 eliminated unused var
+  cum       : LOGICAL := UNKNOWN; --*TY2021/02/28 to protect against indeterminate function inputs
   vspc      : maths_space;
   sspc      : maths_space;
   smem      : SET OF maths_value;
   factors   : LIST OF maths_space;
+ 	v_LIST : LIST OF GENERIC; --*TY2021/02/20
 END_LOCAL;
   IF NOT EXISTS(s)
   THEN
@@ -43042,12 +43190,13 @@
   THEN
     IF 'LIST' IN vtypes
     THEN
-      IF SIZEOF(v) = s\uniform_product_space.exponent
+ 			v_LIST := v; --*TY2021/02/20
+      IF SIZEOF(v_LIST) = s\uniform_product_space.exponent --*TY2021/02/20: IF SIZEOF(v) = s\uniform_product_space.exponent
       THEN
         sspc := s\uniform_product_space.base;
         cum := true;
-        REPEAT i := 1 TO SIZEOF(v);
-          cum := cum AND member_of(v[i], sspc);
+        REPEAT i := 1 TO SIZEOF(v_LIST); --*TY2021/02/20: REPEAT i := 1 TO SIZEOF(v);
+          cum := cum AND member_of(v_LIST[i], sspc); --*TY2021/02/20: cum := cum AND member_of(v[i], sspc);
           IF cum = false
           THEN
             RETURN(false);
@@ -43062,12 +43211,13 @@
   THEN
     IF 'LIST' IN vtypes
     THEN
+ 			v_LIST := v; --*TY2021/02/20
       factors := s\listed_product_space.factors;
-      IF SIZEOF(v) = SIZEOF(factors)
+      IF SIZEOF(v_LIST) = SIZEOF(factors) --*TY2021/02/20: IF SIZEOF(v) = SIZEOF(factors)
       THEN
         cum := true;
-        REPEAT i := 1 TO SIZEOF(v);
-          cum := cum AND member_of(v[i], factors[i]);
+        REPEAT i := 1 TO SIZEOF(v_LIST); --*TY2021/02/20: REPEAT i := 1 TO SIZEOF(v);
+          cum := cum AND member_of(v_LIST[i], factors[i]); --*TY2021/02/20: cum := cum AND member_of(v[i], factors[i]);
           IF cum = false
           THEN
             RETURN(false);
@@ -43082,21 +43232,22 @@
   THEN
     IF 'LIST' IN vtypes
     THEN
+ 			v_LIST := v; --*TY2021/02/20
       sspc := s\extended_tuple_space.base;
       tmp_int := space_dimension(sspc);
-      IF SIZEOF(v) >= tmp_int
+      IF SIZEOF(v_LIST) >= tmp_int --*TY2021/02/20: IF SIZEOF(v) >= tmp_int
       THEN
         cum := true;
         REPEAT i := 1 TO tmp_int;
-          cum := cum AND member_of(v[i], factor_space(sspc, i));
+          cum := cum AND member_of(v_LIST[i], factor_space(sspc, i)); --*TY2021/02/20: cum := cum AND member_of(v[i], factor_space(sspc, i));
           IF cum = false
           THEN
             RETURN(false);
           END_IF;
         END_REPEAT;
         sspc := s\extended_tuple_space.extender;
-        REPEAT i := tmp_int + 1 TO SIZEOF(v);
-          cum := cum AND member_of(v[i], sspc);
+        REPEAT i := tmp_int + 1 TO SIZEOF(v_LIST); --*TY2021/02/20: REPEAT i := tmp_int + 1 TO SIZEOF(v);
+          cum := cum AND member_of(v_LIST[i], sspc); --*TY2021/02/20: cum := cum AND member_of(v[i], sspc);
           IF cum = false
           THEN
             RETURN(false);
@@ -44129,10 +44280,12 @@
 FUNCTION set_of_topology_reversed(a_set : set_of_reversible_topology_item) : set_of_reversible_topology_item;
 LOCAL
   the_reverse : set_of_reversible_topology_item;
+ reversed: reversible_topology_item; --*TY2021/02/24
 END_LOCAL;
   the_reverse := [];
   REPEAT i := 1 TO SIZEOF(a_set);
-    the_reverse := the_reverse + topology_reversed(a_set[i]);
+ 		reversed := topology_reversed(a_set[i]); --*TY2021/02/24
+    the_reverse := the_reverse + reversed; --*TY2021/02/24: the_reverse := the_reverse + topology_reversed(a_set[i]);
   END_REPEAT;
   RETURN(the_reverse);
 END_FUNCTION;
@@ -44241,6 +44394,9 @@
   tpl           : LIST OF maths_value;
   tp2           : LIST OF maths_value;
   mem           : SET OF maths_value                         := [];
+  v1_string : STRING; v2_string : STRING; --*TY2021/02/18
+  tpl_integer : INTEGER; tp2_integer : INTEGER; --*TY2021/02/18
+  tpl_real : REAL; tp2_real : REAL; --*TY2021/02/18
 END_LOCAL;
   REPEAT i := 1 TO SIZEOF(expr.arguments);
     v := simplify_maths_value(expr.arguments[i]);
@@ -45093,7 +45249,8 @@
       END_IF;
       ef_like : IF ('STRING' IN TYPEOF(v1)) AND ('STRING' IN TYPEOF(v2))
       THEN
-        RETURN(ctmv(v1 LIKE v2));
+				v1_string := v1; v2_string := v2; --*TY2021/02/18
+ 				RETURN(ctmv(v1_string LIKE v2_string)); --*TY2021/02/18: RETURN(ctmv(v1 LIKE v2));
       END_IF;
       ef_subscript_b : IF ('BINARY' IN TYPEOF(v1)) AND ('INTEGER' IN TYPEOF(v2))
       THEN
@@ -45293,8 +45450,9 @@
                                THEN
                                  RETURN(?);
                                END_IF;
-                               REPEAT l := 1 TO SIZEOF(tpl);
-                                 tpl[j] := tpl[j] + tp2[j];
+                               REPEAT j := 1 TO SIZEOF(tpl); --*TY2021/02/18 bug fix: REPEAT l := 1 TO SIZEOF(tpl);
+																 tpl_integer := tpl[j]; tp2_integer := tp2[j]; --*TY2021/02/18
+ 																 tpl[j] := tpl_integer + tp2_integer; --*TY2021/02/18: tpl[j] := tpl[j] + tp2[j];
                                END_REPEAT;
                              END_IF;
                              REMOVE(vlist, i);
@@ -45322,7 +45480,8 @@
           RETURN(?);
         END_IF;
         REPEAT i := 1 TO SIZEOF(tpl);
-          tpl[i] := tpl[i] - tp2[i];
+ 				  tpl_integer := tpl[i]; tp2_integer := tp2[i]; --*TY2021/02/18
+ 					tpl[i] := tpl_integer - tp2_integer; --*TY2021/02/18: tpl[i] := tpl[i] - tp2[i];
         END_REPEAT;
         RETURN(ctmv(tpl));
       END_IF;
@@ -45345,7 +45504,8 @@
           RETURN(?);
         END_IF;
         REPEAT i := 1 TO SIZEOF(tpl);
-          j := j + tpl[i] * tp2[i];
+          tpl_integer := tpl[i]; tp2_integer := tp2[i]; --*TY2021/02/18
+          j := j + tpl_integer * tp2_integer; --*TY2021/02/18: j := j + tpl[i] * tp2[i];
         END_REPEAT;
         RETURN(ctmv(j));
       END_IF;
@@ -45382,8 +45542,9 @@
                                THEN
                                  RETURN(?);
                                END_IF;
-                               REPEAT l := 1 TO SIZEOF(tpl);
-                                 tpl[j] := tpl[j] + tp2[j];
+                               REPEAT j := 1 TO SIZEOF(tpl); --*TY2021/02/18 bug fix: REPEAT l := 1 TO SIZEOF(tpl);
+ 																 tpl_real := tpl[j]; tp2_real := tp2[j]; --*TY2021/02/18
+                                 tpl[j] := tpl_real + tp2_real; --*TY2021/02/18: tpl[j] := tpl[j] + tp2[j];
                                END_REPEAT;
                              END_IF;
                              REMOVE(vlist, i);
@@ -45411,7 +45572,8 @@
           RETURN(?);
         END_IF;
         REPEAT i := 1 TO SIZEOF(tpl);
-          tpl[i] := tpl[i] - tp2[i];
+          tpl_real := tpl[i]; tp2_real := tp2[i]; --*TY2021/02/18
+          tpl[i] := tpl_real - tp2_real; --*TY2021/02/18: tpl[i] := tpl[i] - tp2[i];
         END_REPEAT;
         RETURN(ctmv(tpl));
       END_IF;
@@ -45434,7 +45596,8 @@
           RETURN(?);
         END_IF;
         REPEAT i := 1 TO SIZEOF(tpl);
-          r := r + tpl[i] * tp2[i];
+ 					tpl_real := tpl[i]; tp2_real := tp2[i]; --*TY2021/02/18
+          r := r + tpl_real * tp2_real; --*TY2021/02/18: r := r + tpl[i] * tp2[i];
         END_REPEAT;
         RETURN(ctmv(r));
       END_IF;
@@ -45443,7 +45606,8 @@
         tpl := v1;
         r := 0.0;
         REPEAT i := 1 TO SIZEOF(tpl);
-          r := r + tpl[i] * tpl[i];
+ 					tpl_real := tpl[i]; tp2_real := tp2[i]; --*TY2021/02/18
+          r := r + tpl_real * tp2_real; --*TY2021/02/18: r := r + tpl[i] * tpl[i];
         END_REPEAT;
         RETURN(ctmv(SQRT(r)));
       END_IF;
@@ -45486,7 +45650,7 @@
                                THEN
                                  RETURN(?);
                                END_IF;
-                               REPEAT l := 1 TO SIZEOF(tpl);
+                               REPEAT j := 1 TO SIZEOF(tpl); --*TY2021/02/18 bug fix: REPEAT l := 1 TO SIZEOF(tpl);
                                  parts(tpl[j], p, q);
                                  parts(tp2[j], r, s);
                                  tpl[j] := makec(p + r, q + s);
@@ -45643,6 +45807,9 @@
   boo    : BOOLEAN;
   str    : STRING;
   nmb    : NUMBER;
+  v1_string : STRING; v2_string : STRING;	--*TY2021/02/18
+  v1_number : NUMBER; v2_number : NUMBER;	--*TY2021/02/18
+
 END_LOCAL;
   IF 'INT_LITERAL' IN types
   THEN
@@ -45799,7 +45966,9 @@
               ELSE
                 IF 'LIKE_EXPRESSION' IN types
                 THEN
-                  boo := bool(v1 LIKE v2);
+ 									v1_string := v1; v2_string := v2;	--*TY2021/02/18
+                  -- boo := bool(v1 LIKE v2);	--*TY2021/02/18
+ 									boo := bool(v1_string LIKE v2_string);	--*TY2021/02/18
                 ELSE
                   RETURN(?);
                 END_IF;
@@ -45846,7 +46015,9 @@
   END_IF;
   IF ('DIV_EXPRESSION' IN types) AND ('NUMBER' IN TYPEOF(v1)) AND ('NUMBER' IN TYPEOF(v2))
   THEN
-    RETURN(convert_to_maths_value(v1 DIV v2));
+ 		v1_number := v1; v2_number := v2; --*TY2021/02/18
+    -- RETURN(convert_to_maths_value(v1 DIV v2)); --*TY2021/02/18
+ 		RETURN(convert_to_maths_value(v1_number DIV v2_number)); --*TY2021/02/18
   END_IF;
   IF 'EQUALS_EXPRESSION' IN types
   THEN
@@ -45965,11 +46136,15 @@
   END_IF;
   IF ('MINUS_EXPRESSION' IN types) AND ('NUMBER' IN TYPEOF(v1)) AND ('NUMBER' IN TYPEOF(v2))
   THEN
-    RETURN(convert_to_maths_value(v1 - v2));
+ 		v1_number := v1; v2_number := v2; --*TY2021/02/18
+    -- RETURN(convert_to_maths_value(v1 - v2)); --*TY2021/02/18
+ 		RETURN(convert_to_maths_value(v1_number - v2_number)); --*TY2021/02/18
   END_IF;
   IF ('MOD_EXPRESSION' IN types) AND ('NUMBER' IN TYPEOF(v1)) AND ('NUMBER' IN TYPEOF(v2))
   THEN
-    RETURN(convert_to_maths_value(v1 MOD v2));
+ 		v1_number := v1; v2_number := v2; --*TY2021/02/18
+    -- RETURN(convert_to_maths_value(v1 MOD v2)); --*TY2021/02/18
+ 		RETURN(convert_to_maths_value(v1_number MOD v2_number)); --*TY2021/02/18
   END_IF;
   IF 'MULT_EXPRESSION' IN types
   THEN
@@ -46050,7 +46225,9 @@
   END_IF;
   IF ('POWER_EXPRESSION' IN types) AND ('NUMBER' IN TYPEOF(v1)) AND ('NUMBER' IN TYPEOF(v2))
   THEN
-    RETURN(convert_to_maths_value(v1 ** v2));
+ 		v1_number := v1; v2_number := v2; --*TY2021/02/18
+    -- RETURN(convert_to_maths_value(v1 ** v2)); --*TY2021/02/18
+    RETURN(convert_to_maths_value(v1_number ** v2_number)); --*TY2021/02/18
   END_IF;
   IF ('SIN_EXPRESSION' IN types) AND ('NUMBER' IN TYPEOF(v1))
   THEN
@@ -46058,7 +46235,9 @@
   END_IF;
   IF ('SLASH_EXPRESSION' IN types) AND ('NUMBER' IN TYPEOF(v1)) AND ('NUMBER' IN TYPEOF(v2))
   THEN
-    RETURN(convert_to_maths_value(v1 / v2));
+ 		v1_number := v1; v2_number := v2; --*TY2021/02/18
+    -- RETURN(convert_to_maths_value(v1 / v2)); --*TY2021/02/18
+    RETURN(convert_to_maths_value(v1_number / v2_number)); --*TY2021/02/18
   END_IF;
   IF ('SQUARE_ROOT_EXPRESSION' IN types) AND ('NUMBER' IN TYPEOF(v1))
   THEN
@@ -46361,7 +46540,7 @@
   spc2   : maths_space                  := simplify_maths_space(space2);
   types1 : SET OF STRING                := stripped_typeof(spc1);
   types2 : SET OF STRING                := stripped_typeof(spc2);
-  lgcl   : LOGICAL;
+  -- lgcl   : LOGICAL;	**TY2021/02/28 eliminated unused var
   cum    : LOGICAL;
   es_val : elementary_space_enumerators;
   bnd1   : REAL;
@@ -46989,8 +47168,8 @@
 LOCAL
   local_p_d : SET OF product_definition   := [];
   local_s_r : SET OF shape_representation := [];
-  i         : INTEGER;
-  j         : INTEGER;
+  -- i         : INTEGER;	**TY2021/02/28 eliminated unused var
+  -- j         : INTEGER;	**TY2021/02/28 eliminated unused var
 END_LOCAL;
   local_p_d := using_product_definition_of_shape_representation(item);
   IF (SIZEOF(local_p_d) <> 1)
@@ -47016,8 +47195,8 @@
 LOCAL
   local_s_a : SET OF shape_aspect         := [];
   local_s_r : SET OF shape_representation := [];
-  i         : INTEGER;
-  j         : INTEGER;
+  -- i         : INTEGER;	**TY2021/02/28 eliminated unused var
+  -- j         : INTEGER;	**TY2021/02/28 eliminated unused var
 END_LOCAL;
   local_s_a := using_shape_aspect_of_shape_representation(item);
   IF (SIZEOF(local_s_a) <> 1)
@@ -47068,10 +47247,49 @@
 
 FUNCTION using_items(item : founded_item_select;
                      checked_items : SET OF founded_item_select) : SET OF founded_item_select;
+
+ --*TY2021/06/27 alternative implementation proposal
+LOCAL
+	result_items    			: SET OF founded_item_select;
+	next_items      			: SET OF founded_item_select;
+ 	number_of_next_items 	: INTEGER;
+ 	next_item							: founded_item_select;
+ 	new_check_items 			: SET OF founded_item_select;
+	descendants     			: SET OF founded_item_select;
+END_LOCAL;
+  IF item IN checked_items THEN
+		RETURN([]);
+	END_IF;
+  checked_items := checked_items + item;
+
+  result_items := QUERY(z
+										 <* bag_to_set(USEDIN(item, ''))
+										 | ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.REPRESENTATION_ITEM' IN TYPEOF(z)) OR
+											 ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.FOUNDED_ITEM' IN TYPEOF(z)));
+	next_items := result_items - checked_items; 
+ 
+ 	number_of_next_items := SIZEOF(next_items);
+  IF number_of_next_items = 0 THEN
+ 		RETURN(result_items);
+ 	END_IF;
+
+ 	REPEAT i := 1 TO number_of_next_items;
+ 		next_item := next_items[i];
+ 		new_check_items := checked_items + (next_items - next_item);
+ 		descendants := using_items(next_item, new_check_items);
+		result_items := result_items + descendants;
+ 		checked_items := checked_items + next_item + descendants;
+ 	END_REPEAT;
+ 
+ 	RETURN(result_items);
+ 
+ 
+ (* --*TY2021/06/27 original implementation
 LOCAL
   new_check_items : SET OF founded_item_select;
   result_items    : SET OF founded_item_select;
   next_items      : SET OF founded_item_select;
+  found_descendants: SET OF founded_item_select; --*TY2021/06/10 to prevent duplicated search
 END_LOCAL;
   result_items := [];
   new_check_items := checked_items + item;
@@ -47084,11 +47302,17 @@
     REPEAT i := 1 TO HIINDEX(next_items);
       IF NOT (next_items[i] IN new_check_items)
       THEN
-        result_items := result_items + next_items[i] + using_items(next_items[i], new_check_items);
+				--*TY2021/06/10: result_items := result_items + next_items[i] + using_items(next_items[i], new_check_items);
+ 				found_descendants := next_items[i] + using_items(next_items[i], new_check_items);
+        new_check_items := new_check_items + found_descendants;
+ 				result_items := result_items + found_descendants;
+ 				--*TY2021/06/10 end modification
       END_IF;
     END_REPEAT;
   END_IF;
   RETURN(result_items);
+ --*TY2021/06/27 end of original implementation*)
+ 
 END_FUNCTION;
 
 FUNCTION using_product_definition_of_shape_aspect(item : shape_aspect) : product_definition;
@@ -47104,7 +47328,8 @@
 LOCAL
   local_s_d_r : SET OF shape_definition_representation := [];
   local_p_d   : SET OF product_definition              := [];
-  i           : INTEGER;
+  -- i           : INTEGER;	**TY2021/02/28 eliminated unused var
+  p_d : product_definition; --*TY2021/02/24
 END_LOCAL;
   local_s_d_r := QUERY(i1
                        <* bag_to_set(USEDIN(item,
@@ -47118,8 +47343,9 @@
       IF ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.PRODUCT_DEFINITION' IN
           TYPEOF(local_s_d_r[i]\property_definition_representation.definition\property_definition.definition))
       THEN
+ 				p_d := local_s_d_r[i]\property_definition_representation.definition\property_definition.definition; --*TY2021/02/24
         local_p_d := local_p_d +
-                     local_s_d_r[i]\property_definition_representation.definition\property_definition.definition;
+                     p_d; --*TY2024/02/24: local_s_d_r[i]\property_definition_representation.definition\property_definition.definition;
       END_IF;
     END_IF;
   END_REPEAT;
@@ -47132,8 +47358,8 @@
   local_results            : SET OF representation      := [];
   local_representation_map : SET OF representation_map  := [];
   intermediate_items       : SET OF representation_item := [];
-  i                        : INTEGER;
-  j                        : INTEGER;
+  -- i                        : INTEGER;	**TY2021/02/28 eliminated unused var
+  -- j                        : INTEGER;	**TY2021/02/28 eliminated unused var
 END_LOCAL;
   local_results := QUERY(z
                          <* using_representations(item)
@@ -47155,7 +47381,7 @@
                                               'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.MAPPED_ITEM.MAPPING_SOURCE'));
     END_REPEAT;
     REPEAT j := 1 TO HIINDEX(intermediate_items);
-      results := results + bag_to_set(using_representation_with_mapping(intermediate_items[j]));
+      results := results + using_representation_with_mapping(intermediate_items[j]); --*ty2021/02/18 bug fix: results := results + bag_to_set(using_representation_with_mapping(intermediate_items[j]));
     END_REPEAT;
   END_IF;
   RETURN(results);
@@ -47197,7 +47423,8 @@
   local_s_d_r  : SET OF shape_definition_representation := [];
   local_s_d_r2 : BAG OF shape_definition_representation := [];
   local_s_a    : SET OF shape_aspect                    := [];
-  i            : INTEGER;
+  -- i            : INTEGER;	**TY2021/02/28 eliminated unused var
+  s_a : shape_aspect;--*TY2021/02/24
 END_LOCAL;
   local_s_d_r2 := local_s_d_r2 +
                   QUERY(pdr
@@ -47210,8 +47437,9 @@
     IF ('AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.SHAPE_ASPECT' IN
         TYPEOF(local_s_d_r[i]\property_definition_representation.definition\property_definition.definition))
     THEN
+			s_a := local_s_d_r[i]\property_definition_representation.definition\property_definition.definition; --*TY2021/02/24
       local_s_a := local_s_a +
-                   local_s_d_r[i]\property_definition_representation.definition\property_definition.definition;
+                   s_a; --*TY2021/02/24: local_s_d_r[i]\property_definition_representation.definition\property_definition.definition;
     END_IF;
   END_REPEAT;
   RETURN(local_s_a);
@@ -47966,7 +48194,7 @@
 LOCAL
   id_length : INTEGER := LENGTH(attid);
   id_valid  : BOOLEAN := true;
-  i         : INTEGER;
+  -- i         : INTEGER;	**TY2021/02/28 eliminated unused var
 END_LOCAL;
   IF NOT (attid[1] IN letters)
   THEN
@@ -47984,7 +48212,7 @@
 
 FUNCTION validate_countersink_radii(cskhole : solid_with_stepped_round_hole_and_conical_transitions) : BOOLEAN;
 LOCAL
-  i       : INTEGER;
+  -- i       : INTEGER;	**TY2021/02/28 eliminated unused var
   j       : INTEGER;
   n       : INTEGER                 := 1 + cskhole\solid_with_stepped_round_hole.segments;
   smaller : positive_length_measure;
@@ -48854,6 +49082,7 @@
   pdpdca : SET OF product_definition                     := [];
   pdadr  : SET OF product_definition                     := [];
   pass   : BOOLEAN                                       := true;
+  pd : product_definition; --*TY2021/02/24
 END_LOCAL;
   REPEAT i := 1 TO HIINDEX(pdca);
     pdpdca := pdpdca + pdca[i]\product_definition_context_association.definition;
@@ -48869,7 +49098,8 @@
       IF 'AP242_MANAGED_MODEL_BASED_3D_ENGINEERING_MIM_LF.PRODUCT_DEFINITION' IN
          TYPEOF(adr[i]\applied_document_reference.items[j])
       THEN
-        pdadr := pdadr + adr[i]\applied_document_reference.items[j];
+ 				pd := adr[i]\applied_document_reference.items[j]; --*TY2021/02/24
+        pdadr := pdadr + pd; --*TY2021/02/24: adr[i]\applied_document_reference.items[j];
       END_IF;
     END_REPEAT;
   END_REPEAT;
@@ -48999,9 +49229,9 @@
                         next_assembly_usage_occurrence,
                         product_related_product_category);
 LOCAL
-  i     : INTEGER;
-  j     : INTEGER;
-  k     : INTEGER;
+  -- i     : INTEGER;	**TY2021/02/28 eliminated unused var
+  -- j     : INTEGER;	**TY2021/02/28 eliminated unused var
+  -- k     : INTEGER;	**TY2021/02/28 eliminated unused var
   dkuhr : LOGICAL := true;
   nnauo : INTEGER;
   nprpc : INTEGER := 0;
@@ -49046,10 +49276,10 @@
 
 RULE ply_stock_material_select FOR (product_related_product_category, make_from_usage_option);
 LOCAL
-  i     : INTEGER;
-  j     : INTEGER;
-  k     : INTEGER;
-  kp    : INTEGER;
+  -- i     : INTEGER;	**TY2021/02/28 eliminated unused var
+  -- j     : INTEGER;	**TY2021/02/28 eliminated unused var
+  -- k     : INTEGER;	**TY2021/02/28 eliminated unused var
+  -- kp    : INTEGER;	**TY2021/02/28 eliminated unused var
   dkuhr : LOGICAL;
   nmfuo : INTEGER;
   nprpc : INTEGER := 0;
